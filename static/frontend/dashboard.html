<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Brewery Dashboard</h1>

        <!-- Section to display Breweries -->
        <section id="breweries-section">
            <h2>Breweries</h2>
            <button id="load-breweries" class="btn btn-primary mb-3">Load Breweries</button>
            <ul id="breweries-list" class="list-group"></ul>
        </section>

        <!-- Section to display Beer Types -->
        <section id="beer-types-section" class="mt-5">
            <h2>Beer Types</h2>
            <button id="load-beer-types" class="btn btn-secondary mb-3">Load Beer Types</button>
            <ul id="beer-types-list" class="list-group"></ul>
        </section>

        <!-- Section to display Ingredients -->
        <section id="ingredients-section" class="mt-5">
            <h2>Ingredients</h2>
            <button id="load-ingredients" class="btn btn-success mb-3">Load Ingredients</button>
            <ul id="ingredients-list" class="list-group"></ul>
        </section>

        <!-- Form to create a new Brewery -->
        <section id="create-brewery-section" class="mt-5">
            <h2>Create Brewery</h2>
            <form id="create-brewery-form">
                <div class="mb-3">
                    <label for="brewery-name" class="form-label">Name</label>
                    <input type="text" id="brewery-name" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="brewery-location" class="form-label">Location</label>
                    <input type="text" id="brewery-location" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="establishment-date" class="form-label">Establishment Date</label>
                    <input type="date" id="establishment-date" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-outline-primary">Create Brewery</button>
            </form>
            <div id="create-brewery-result" class="mt-3"></div>
        </section>
    </div>

    <script>
        // Fetch and display breweries
        document.getElementById('load-breweries').onclick = async () => {
            const response = await fetch('/breweries/');
            const breweries = await response.json();
            const list = document.getElementById('breweries-list');
            list.innerHTML = '';
            breweries.forEach(brewery => {
                const li = document.createElement('li');
                li.textContent = `${brewery.name} - ${brewery.location}`;
                li.className = 'list-group-item';
                list.appendChild(li);
            });
        };

        // Fetch and display beer types
        document.getElementById('load-beer-types').onclick = async () => {
            const response = await fetch('/beer_types/');
            const beerTypes = await response.json();
            const list = document.getElementById('beer-types-list');
            list.innerHTML = '';
            beerTypes.forEach(type => {
                const li = document.createElement('li');
                li.textContent = type.name;
                li.className = 'list-group-item';
                list.appendChild(li);
            });
        };

        // Fetch and display ingredients
        document.getElementById('load-ingredients').onclick = async () => {
            const response = await fetch('/ingredients/');
            const ingredients = await response.json();
            const list = document.getElementById('ingredients-list');
            list.innerHTML = '';
            ingredients.forEach(ingredient => {
                const li = document.createElement('li');
                li.textContent = ingredient.name;
                li.className = 'list-group-item';
                list.appendChild(li);
            });
        };

        // Create a new brewery
        document.getElementById('create-brewery-form').onsubmit = async (event) => {
            event.preventDefault();
            const name = document.getElementById('brewery-name').value;
            const location = document.getElementById('brewery-location').value;
            // const establishment_date = document.getElementById('establishment-date').value;
            const establishment_date = new Date(document.getElementById('establishment-date').value).toISOString().split('T')[0];
            
            console.log('Отправляемые данные:', { name, location, establishment_date });

            // const response = await fetch('/breweries/', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({ name, location, establishment_date })
            // });

            let proj = {name: name,
                    location: location,
                    establishment_date: establishment_date}
            // proj.push(
            //     {
            //         name: name,
            //         location: location,
            //         establishment_date: establishment_date
            //     }
            // )
            let dataToSend = JSON.stringify(proj)

            const response = await fetch('/breweries/', {
                method: 'post',
                headers: { 'Content-Type': 'application/json' },
                body: dataToSend
            })

            const result = await response.json();
            // document.getElementById('create-brewery-result').textContent = 'Запись создана!';
        };
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
</body>
</html>
